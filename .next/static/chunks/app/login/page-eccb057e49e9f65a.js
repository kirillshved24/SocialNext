(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{5031:(e,t,r)=>{Promise.resolve().then(r.bind(r,6751))},267:(e,t,r)=>{"use strict";r.d(t,{G:()=>o,_:()=>d});var n=r(698),a=r(5285);function i(){let e=(0,n._)(["\n     max-width: 400px;\n    margin: 0 auto;\n    padding: 20px;\n    background-color: #b39393;\n    border-radius: 10px;\n    box-shadow: 0 4px 10px rgb(39 5 5 / 10%);\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n"]);return i=function(){return e},e}function s(){let e=(0,n._)(["\ndisplay: flex;\n    flex-direction: column;\n    max-width: 280px;\n    width: 100%;\n  \n    gap: 15px;\n    padding: 33px 58px;\n"]);return s=function(){return e},e}let d=a.Ay.div(i()),o=a.Ay.form(s())},6751:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A});var n=r(5155),a=r(2115),i=r(3391),s=r(6639),d=r(6046),o=r(5360),l=r(1591),u=r(2817),c=r(539),p=r(9606),f=r(4877),x=r(267),h=r(698);function m(){let e=(0,h._)(["\ndisplay: flex\n;\n    flex-direction: column;\n    gap: 15px;\n    padding: 12px 21px;\n    max-width: 361px;\n    width: 100%;\n"]);return m=function(){return e},e}let g=r(5285).Ay.form(m()),v=/^[A-Z][a-zA-Z0-9]{2,}$/,y=/^(?=.*[a-zA-Z])(?=.*[!@#$%^&*])/,w=()=>{var e,t;let r=(0,i.wA)(),h=(0,d.useRouter)(),[m,w]=(0,a.useState)(null),{register:A,handleSubmit:b,formState:{errors:j}}=(0,p.mN)();return(0,a.useEffect)(()=>{if(m){let{username:e,password:t}=m,n=(JSON.parse(localStorage.getItem("users"))||[]).find(r=>r.username===e&&r.password===t);n?(r((0,s.iD)({username:n.username,email:n.email,id:n.id,isAdmin:n.isAdmin})),h.push("/")):alert("Неправильное имя пользователя или пароль")}},[m,r,h]),(0,n.jsx)(o.m,{children:(0,n.jsxs)(x._,{children:[(0,n.jsx)(c.h,{children:"Вход"}),(0,n.jsxs)(g,{onSubmit:b(e=>{w(e)}),children:[(0,n.jsx)(f.J,{children:(0,n.jsx)(l.p,{name:"username",type:"text",placeholder:"Имя пользователя",errorMessage:null===(e=j.username)||void 0===e?void 0:e.message,...A("username",{required:"Имя пользователя обязательно",pattern:{value:v,message:"Имя пользователя должно начинаться с заглавной буквы и быть не меньше 3 символов"}})})}),(0,n.jsx)(f.J,{children:(0,n.jsx)(l.p,{name:"password",type:"password",placeholder:"Пароль",errorMessage:null===(t=j.password)||void 0===t?void 0:t.message,...A("password",{required:"Пароль обязателен",pattern:{value:y,message:"Пароль должен содержать хотя бы одну заглавную букву и один спецсимвол"}})})}),(0,n.jsx)(u.$,{type:"submit",children:"Войти"})]})]})})};function A(){return(0,n.jsx)(w,{})}},6639:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>c,_J:()=>d,gT:()=>i,iD:()=>l,oe:()=>s,ri:()=>u});var n=r(8943),a=r(2651);(0,n.zD)("auth/loginUser",async(e,t)=>{let{username:r,password:n}=e,{rejectWithValue:i}=t;try{let{token:e}=(await a.A.post("/api/auth/login",{username:r,password:n})).data;return console.log("Токен после логина:",e),localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var s;return i((null===(s=e.response)||void 0===s?void 0:s.data)||e.message)}}),(0,n.zD)("auth/registerUser",async(e,t)=>{let{username:r,password:n,email:i}=e,{rejectWithValue:s}=t;try{let{token:e}=(await a.A.post("/api/auth/register",{username:r,password:n,email:i})).data;return localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var d;return s((null===(d=e.response)||void 0===d?void 0:d.data)||e.message)}});let i=(0,n.zD)("auth/fetchFriends",async(e,t)=>{let{rejectWithValue:r}=t;try{let t=localStorage.getItem("token");if(!t)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.get("/api/friends",{params:{userId:e},headers:{Authorization:"Bearer ".concat(t)}})).data}catch(e){var n;return r((null===(n=e.response)||void 0===n?void 0:n.data)||e.message)}}),s=(0,n.zD)("auth/addFriendToServer",async(e,t)=>{let{friendId:r}=e,{rejectWithValue:n}=t;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.post("/api/friends",{friendId:r},{headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var i;return n((null===(i=e.response)||void 0===i?void 0:i.data)||e.message)}}),d=(0,n.zD)("auth/removeFriendFromServer",async(e,t)=>{let{userId:r,friendId:n}=e,{rejectWithValue:i}=t;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return await a.A.delete("/api/friends",{data:{userId:r,friendId:n},headers:{Authorization:"Bearer ".concat(e)}}),{userId:r,friendId:n}}catch(e){var s;return i((null===(s=e.response)||void 0===s?void 0:s.data)||e.message)}}),o=(0,n.Z0)({name:"auth",initialState:{currentUser:null,isAdmin:!1,isAuthenticated:!1,friends:[],status:"idle",error:null},reducers:{login:(e,t)=>{let{username:r,email:n,id:a,isAdmin:i,token:s}=t.payload;e.currentUser={username:r,email:n,id:a},e.isAdmin=i,e.isAuthenticated=!0,localStorage.setItem("token",s)},logout:e=>{localStorage.removeItem("token"),e.currentUser=null,e.isAdmin=!1,e.isAuthenticated=!1,e.friends=[]}},extraReducers:e=>{e.addCase(i.pending,e=>{e.status="loading"}).addCase(i.fulfilled,(e,t)=>{e.status="succeeded",e.friends=t.payload}).addCase(i.rejected,(e,t)=>{e.status="failed",e.error=t.payload}).addCase(s.pending,e=>{e.status="loading"}).addCase(s.fulfilled,(e,t)=>{e.status="succeeded",e.friends.push(t.payload)}).addCase(s.rejected,(e,t)=>{e.status="failed",e.error=t.payload}).addCase(d.pending,e=>{e.status="loading"}).addCase(d.fulfilled,(e,t)=>{e.status="succeeded",e.friends=e.friends.filter(e=>e.id!==t.payload.friendId)}).addCase(d.rejected,(e,t)=>{e.status="failed",e.error=t.payload})}}),{login:l,logout:u}=o.actions,c=o.reducer},2817:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var n=r(5155);r(2115);var a=r(698);function i(){let e=(0,a._)(["\n  border-radius: 10px;\n    color: white;\n    transition: .2s linear;\n    background: #0B63F6;\n    padding: 5px 15px;\n    cursor:pointer;\n\n    &:hover{\n  box-shadow: 0 0 0 2px white, 0 0 0 4px #3C82F8;\n    }\n"]);return i=function(){return e},e}let s=r(5285).Ay.button(i()),d=e=>{let{children:t,...r}=e;return(0,n.jsx)(s,{...r,children:t})}},5360:(e,t,r)=>{"use strict";r.d(t,{m:()=>d});var n=r(5155);r(2115);var a=r(698);function i(){let e=(0,a._)(["\n    max-width: 1024px;\n    margin: 0 auto;\n    gap: 20px;\n    margin-top: 50px;\n"]);return i=function(){return e},e}let s=r(5285).Ay.div(i()),d=e=>{let{children:t}=e;return(0,n.jsx)(s,{children:t})}},1591:(e,t,r)=>{"use strict";r.d(t,{p:()=>f});var n=r(5155),a=r(2115),i=r(698),s=r(5285);function d(){let e=(0,i._)(["\n   width: 100%;\n   \n"]);return d=function(){return e},e}function o(){let e=(0,i._)(["\n    outline: none;\n    border: 1px solid ","; \n    padding: 11px 3px;\n    border-radius: 5px;\n    width: 100%;\n    max-width: 100%;\n  \n\n    &:focus {\n        border-color: ",";\n    }\n"]);return o=function(){return e},e}function l(){let e=(0,i._)(["\n    color: red;\n    font-size: 0.75rem;\n    top: 50%;\n    left: 10px;\n    transform: translateY(-50%);\n    pointer-events: none;\n"]);return l=function(){return e},e}let u=s.Ay.div(d()),c=s.Ay.input(o(),e=>{let{$error:t}=e;return"true"===t?"red":"#282c34"},e=>{let{$error:t}=e;return"true"===t?"red":"#007BFF"}),p=s.Ay.span(l()),f=a.forwardRef((e,t)=>{let{errorMessage:r,...a}=e;return(0,n.jsxs)(u,{children:[(0,n.jsx)(c,{ref:t,...a,$error:r?"true":void 0}),r&&(0,n.jsx)(p,{children:r})]})})},4877:(e,t,r)=>{"use strict";r.d(t,{J:()=>d});var n=r(5155);r(2115);var a=r(698);function i(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  align-items:center;\n  gap: 10px;\n"]);return i=function(){return e},e}let s=r(5285).Ay.label(i()),d=e=>{let{children:t}=e;return(0,n.jsx)(s,{children:t})}},539:(e,t,r)=>{"use strict";r.d(t,{h:()=>d});var n=r(5155);r(2115);var a=r(698);function i(){let e=(0,a._)(["\nfont-size: 26px;\n    line-height: 26px;\n    align-items: center;\n    display: flex;\n    flex-direction: column;\n    font-: 26px;\n    font-weight: 400;\n"]);return i=function(){return e},e}let s=r(5285).Ay.h1(i()),d=e=>{let{children:t}=e;return(0,n.jsx)(s,{children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[694,651,533,441,517,358],()=>t(5031)),_N_E=e.O()}]);