(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[872],{959:(e,n,t)=>{Promise.resolve().then(t.bind(t,6719))},6719:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>j});var r=t(5155),a=t(2115),o=t(3391),i=t(6639),s=t(5360),l=t(2817),d=t(539),c=t(698),u=t(5285);function p(){let e=(0,c._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  padding: 20px;\n  background-color: #f9f9f9;\n  border-radius: 8px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n"]);return p=function(){return e},e}function f(){let e=(0,c._)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px;\n  background-color: #fff;\n  border-radius: 5px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n  margin-bottom: 10px;\n  transition: transform 0.2s ease-in-out;\n\n  &:hover {\n    transform: scale(1.02);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  }\n\n  strong {\n    color: #333;\n  }\n"]);return f=function(){return e},e}function g(){let e=(0,c._)(["\n  list-style-type: none;\n  padding: 0;\n  margin: 0;\n"]);return g=function(){return e},e}function h(){let e=(0,c._)(["\n  padding: 8px 12px;\n  border: none;\n  background-color: #5cb85c;\n  color: white;\n  border-radius: 4px;\n  cursor: pointer;\n  font-weight: bold;\n  transition: background-color 0.3s;\n\n  &:hover {\n    background-color: #4cae4c;\n  }\n"]);return h=function(){return e},e}function x(){let e=(0,c._)(["\n  font-style: italic;\n  color: #999;\n  padding: 15px;\n  text-align: center;\n  background-color: #fff;\nborder-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n"]);return x=function(){return e},e}function y(){let e=(0,c._)(["\n  list-style-type: none;\n  padding: 0;\n"]);return y=function(){return e},e}function m(){let e=(0,c._)(["\n  font-style: italic;\n  color: #999;\n"]);return m=function(){return e},e}let v=u.Ay.div(p()),b=u.Ay.div(f());u.Ay.ul(g()),u.Ay.button(h()),u.Ay.div(x());let w=u.Ay.ul(y()),A=u.Ay.p(m()),k=async e=>{try{console.log("Запрос пользователей с currentUser:",e);let n=await fetch("/api/users?currentUser=".concat(e));if(!n.ok)throw Error("Ошибка загрузки данных с сервера: ".concat(n.status));let t=await n.json();return console.log("Пользователи получены:",t),t}catch(e){return console.error("Ошибка при загрузке пользователей:",e),[]}},_=()=>{let[e,n]=(0,a.useState)([]),{currentUser:t,friends:c}=(0,o.d4)(e=>e.auth),u=(0,o.wA)();(0,a.useEffect)(()=>{(async()=>{if(t){console.log("Загружаем пользователей для:",t.username);try{let e=await k(t.username);console.log("Пользователи получены:",e),n(e.filter(e=>!c.some(n=>n.id===e.id)))}catch(e){console.error("Ошибка при загрузке пользователей:",e)}}})(),(null==t?void 0:t.id)&&(console.log("Загружаем друзей для пользователя:",t.id),u((0,i.gT)(t.id)))},[u]);let p=r=>{t&&(console.log("Добавляем друга с ID:",r),u((0,i.oe)({userId:t.id,friendId:r})).unwrap().then(()=>{console.log("Друг успешно добавлен."),n(e.filter(e=>e.id!==r))}).catch(e=>{console.error("Ошибка при добавлении друга:",e)}))};return(0,r.jsx)(s.m,{children:(0,r.jsxs)(v,{children:[(0,r.jsx)(d.h,{children:"Доступные друзья"}),(0,r.jsx)(w,{children:e.length>0?e.map(e=>(0,r.jsxs)(b,{children:[e.username," (",e.email,")",(0,r.jsx)(l.$,{onClick:()=>p(e.id),children:"Добавить"})]},e.id)):(0,r.jsx)(A,{children:"Нет доступных друзей."})})]})})};function j(){return(0,r.jsx)(_,{})}},6639:(e,n,t)=>{"use strict";t.d(n,{Ay:()=>u,_J:()=>s,gT:()=>o,iD:()=>d,oe:()=>i,ri:()=>c});var r=t(8943),a=t(2651);(0,r.zD)("auth/loginUser",async(e,n)=>{let{username:t,password:r}=e,{rejectWithValue:o}=n;try{let{token:e}=(await a.A.post("/api/auth/login",{username:t,password:r})).data;return console.log("Токен после логина:",e),localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var i;return o((null===(i=e.response)||void 0===i?void 0:i.data)||e.message)}}),(0,r.zD)("auth/registerUser",async(e,n)=>{let{username:t,password:r,email:o}=e,{rejectWithValue:i}=n;try{let{token:e}=(await a.A.post("/api/auth/register",{username:t,password:r,email:o})).data;return localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var s;return i((null===(s=e.response)||void 0===s?void 0:s.data)||e.message)}});let o=(0,r.zD)("auth/fetchFriends",async(e,n)=>{let{rejectWithValue:t}=n;try{let n=localStorage.getItem("token");if(!n)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.get("/api/friends",{params:{userId:e},headers:{Authorization:"Bearer ".concat(n)}})).data}catch(e){var r;return t((null===(r=e.response)||void 0===r?void 0:r.data)||e.message)}}),i=(0,r.zD)("auth/addFriendToServer",async(e,n)=>{let{friendId:t}=e,{rejectWithValue:r}=n;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.post("/api/friends",{friendId:t},{headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var o;return r((null===(o=e.response)||void 0===o?void 0:o.data)||e.message)}}),s=(0,r.zD)("auth/removeFriendFromServer",async(e,n)=>{let{userId:t,friendId:r}=e,{rejectWithValue:o}=n;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return await a.A.delete("/api/friends",{data:{userId:t,friendId:r},headers:{Authorization:"Bearer ".concat(e)}}),{userId:t,friendId:r}}catch(e){var i;return o((null===(i=e.response)||void 0===i?void 0:i.data)||e.message)}}),l=(0,r.Z0)({name:"auth",initialState:{currentUser:null,isAdmin:!1,isAuthenticated:!1,friends:[],status:"idle",error:null},reducers:{login:(e,n)=>{let{username:t,email:r,id:a,isAdmin:o,token:i}=n.payload;e.currentUser={username:t,email:r,id:a},e.isAdmin=o,e.isAuthenticated=!0,localStorage.setItem("token",i)},logout:e=>{localStorage.removeItem("token"),e.currentUser=null,e.isAdmin=!1,e.isAuthenticated=!1,e.friends=[]}},extraReducers:e=>{e.addCase(o.pending,e=>{e.status="loading"}).addCase(o.fulfilled,(e,n)=>{e.status="succeeded",e.friends=n.payload}).addCase(o.rejected,(e,n)=>{e.status="failed",e.error=n.payload}).addCase(i.pending,e=>{e.status="loading"}).addCase(i.fulfilled,(e,n)=>{e.status="succeeded",e.friends.push(n.payload)}).addCase(i.rejected,(e,n)=>{e.status="failed",e.error=n.payload}).addCase(s.pending,e=>{e.status="loading"}).addCase(s.fulfilled,(e,n)=>{e.status="succeeded",e.friends=e.friends.filter(e=>e.id!==n.payload.friendId)}).addCase(s.rejected,(e,n)=>{e.status="failed",e.error=n.payload})}}),{login:d,logout:c}=l.actions,u=l.reducer},2817:(e,n,t)=>{"use strict";t.d(n,{$:()=>s});var r=t(5155);t(2115);var a=t(698);function o(){let e=(0,a._)(["\n  border-radius: 10px;\n    color: white;\n    transition: .2s linear;\n    background: #0B63F6;\n    padding: 5px 15px;\n    cursor:pointer;\n\n    &:hover{\n  box-shadow: 0 0 0 2px white, 0 0 0 4px #3C82F8;\n    }\n"]);return o=function(){return e},e}let i=t(5285).Ay.button(o()),s=e=>{let{children:n,...t}=e;return(0,r.jsx)(i,{...t,children:n})}},5360:(e,n,t)=>{"use strict";t.d(n,{m:()=>s});var r=t(5155);t(2115);var a=t(698);function o(){let e=(0,a._)(["\n    max-width: 1024px;\n    margin: 0 auto;\n    gap: 20px;\n    margin-top: 50px;\n"]);return o=function(){return e},e}let i=t(5285).Ay.div(o()),s=e=>{let{children:n}=e;return(0,r.jsx)(i,{children:n})}},539:(e,n,t)=>{"use strict";t.d(n,{h:()=>s});var r=t(5155);t(2115);var a=t(698);function o(){let e=(0,a._)(["\nfont-size: 26px;\n    line-height: 26px;\n    align-items: center;\n    display: flex;\n    flex-direction: column;\n    font-: 26px;\n    font-weight: 400;\n"]);return o=function(){return e},e}let i=t(5285).Ay.h1(o()),s=e=>{let{children:n}=e;return(0,r.jsx)(i,{children:n})}}},e=>{var n=n=>e(e.s=n);e.O(0,[694,651,441,517,358],()=>n(959)),_N_E=e.O()}]);