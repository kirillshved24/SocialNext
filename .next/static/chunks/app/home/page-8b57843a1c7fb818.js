(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{3139:(n,e,t)=>{Promise.resolve().then(t.bind(t,447))},447:(n,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>V});var r=t(5155),i=t(2115),a=t(3391),o=t(5360),d=t(539),l=t(698),s=t(5285);function u(){let n=(0,l._)(["\n display: flex;\n    align-items: center;\n    gap: 15px;\n    padding: 10px 20px;\n    border: 1px solid #ccc;\n    border-radius: 10px;\n    max-width: 350px;\n    margin: 20px 0;\n    background-color: #b89898;\n"]);return u=function(){return n},n}function c(){let n=(0,l._)(["\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n  background-color: #e0e0e0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 24px;\n  color: #555;\n"]);return c=function(){return n},n}function p(){let n=(0,l._)(["\n  font-size: 16px;\n  font-weight: 500;\n  color: #333;\n"]);return p=function(){return n},n}function x(){let n=(0,l._)(["\n    display: flex;\n    gap: 15px;\n    max-width: 1000px;\n    width: 100%;\n"]);return x=function(){return n},n}let f=s.Ay.div(u()),h=s.Ay.div(c()),g=s.Ay.div(p()),m=s.Ay.div(x());var y=t(6639),v=t(2817);function A(){let n=(0,l._)(["\ndisplay: flex;\n    gap: 15px;\n    flex-direction: column;\n    background: #998383;\n    border-radius: 10px;\n    max-width: 250px;\n    width: 100%;\n    margin-top: 20px;\n"]);return A=function(){return n},n}function j(){let n=(0,l._)(["\n  list-style-type: none;\n  padding: 0;\n"]);return j=function(){return n},n}function w(){let n=(0,l._)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 10px;\n  border-bottom: 1px solid #ccc;\n"]);return w=function(){return n},n}function b(){let n=(0,l._)(["\n  font-style: italic;\n  color: #999;\n"]);return b=function(){return n},n}function _(){let n=(0,l._)(["\n   display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    max-width: 1000px;\n    width: 100%;\n    gap: 15px;\n    height: 50%;\n\n"]);return _=function(){return n},n}let k=s.Ay.div(A()),C=s.Ay.ul(j()),z=s.Ay.div(w()),S=s.Ay.p(b());s.Ay.div(_());let D=()=>{let{currentUser:n,friends:e}=(0,a.d4)(n=>n.auth),t=(0,a.wA)();(0,i.useEffect)(()=>{n&&(console.log("Загрузка друзей для текущего пользователя"),t((0,y.gT)(n.id)))},[n,t]);let o=e=>{console.log("Удаление друга:",e),t((0,y._J)(n.id,e.id))};return(0,r.jsxs)(k,{children:[(0,r.jsx)(d.h,{children:"Ваши друзья"}),(0,r.jsx)(C,{children:Array.isArray(e)&&e.length>0?e.map(n=>(0,r.jsxs)(z,{children:[n.username,(0,r.jsx)(v.$,{onClick:()=>o(n),children:"Удалить"})]},n.id)):(0,r.jsx)(S,{children:"У вас нет друзей."})})]})};function I(){let n=(0,l._)(["\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    align-items: center;\n    max-width: 600px;\n    width: 100%;\n"]);return I=function(){return n},n}function E(){let n=(0,l._)(["\n margin-top: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    max-width: 600px;\n    width: 100%;\n"]);return E=function(){return n},n}function U(){let n=(0,l._)(["\npadding: 15px;\n    border-radius: 5px;\n    margin-bottom: 15px;\n    background-color: #978080;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n"]);return U=function(){return n},n}function F(){let n=(0,l._)(["\n  font-weight: bold;\n  margin-top: 5px;\n"]);return F=function(){return n},n}function N(){let n=(0,l._)(["\n  list-style-type: none;\n  padding: 0;\n  margin-top: 10px;\n"]);return N=function(){return n},n}function B(){let n=(0,l._)(["\n  padding: 10px;\n  background-color: #eee;\n  border-radius: 4px;\n  margin-top: 5px;\n"]);return B=function(){return n},n}function J(){let n=(0,l._)(["\n  margin-top: 10px;\n  padding: 8px;\n  width: 100%;\n  box-sizing: border-box;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n"]);return J=function(){return n},n}function O(){let n=(0,l._)(["\n    font-size: 26px;\n    line-height: 16px;\n    align-items: center;\n    display: flex;\n    flex-direction: column;\n    color:white;\n"]);return O=function(){return n},n}function P(){let n=(0,l._)(["\n  display: flex;\n  gap: 10px;\n  margin-top: 10px;\n"]);return P=function(){return n},n}let $=s.Ay.div(I()),T=s.Ay.ul(E()),R=s.Ay.li(U()),Z=s.Ay.p(F()),q=s.Ay.ul(N()),G=s.Ay.li(B()),H=s.Ay.input(J()),K=s.Ay.p(O()),L=s.Ay.div(P()),M=n=>{let{posts:e,currentUser:t,isAdmin:a,onDeletePost:o,onAddComment:l}=n,[s,u]=(0,i.useState)(""),c=n=>{if(!s.trim()){alert("Комментарий не может быть пустым");return}l(n,{id:Date.now(),text:s,author:{username:t.username,name:t.name}}),u("")},p=n=>{var e;return a||(null===(e=n.author)||void 0===e?void 0:e.username)===(null==t?void 0:t.username)};return(0,r.jsx)($,{children:e.length>0?(0,r.jsx)(T,{children:e.map(n=>{var e;return(0,r.jsxs)(R,{children:[(0,r.jsx)(Z,{children:n.author.username}),(0,r.jsx)(K,{children:n.text}),p(n)&&(0,r.jsx)(L,{children:(0,r.jsx)(v.$,{onClick:()=>o(n.id),children:"Удалить пост"})}),(0,r.jsx)(d.h,{children:"Комментарии"}),(0,r.jsx)(q,{children:null===(e=n.comments)||void 0===e?void 0:e.map(n=>(0,r.jsxs)(G,{children:[n.author.username,": ",n.text]},n.id))}),(0,r.jsx)(H,{type:"text",placeholder:"Добавить комментарий",value:s,onChange:n=>u(n.target.value)}),(0,r.jsx)(v.$,{onClick:()=>c(n.id),children:"Добавить комментарий"})]},n.id)})}):(0,r.jsx)(d.h,{children:"Нет постов для отображения."})})},Q=()=>{let n=(0,a.d4)(n=>n.posts.posts),{currentUser:e,isAdmin:t,friends:i}=(0,a.d4)(n=>n.auth),l=(0,a.wA)();console.log("Список друзей на главной странице:",i);let s=n=>i.some(e=>e.username===n.username),u=n.filter(n=>{let e=n.author;return n.isPublic||s(e)||t});return(0,r.jsxs)(o.m,{children:[(0,r.jsx)(d.h,{children:"Добро пожаловать на главную страницу!"}),e&&(0,r.jsxs)(f,{children:[(0,r.jsx)(h,{}),(0,r.jsx)(g,{children:(0,r.jsxs)("p",{children:[e.email," (",t?"Администратор":"Пользователь",")"]})})]}),(0,r.jsxs)(m,{children:[(0,r.jsx)(D,{currentUser:e}),(0,r.jsx)(M,{posts:u,currentUser:e,isAdmin:t,onDeletePost:n=>{l(deletePost({postId:n,currentUser:e,isAdmin:t}))},onAddComment:(n,e)=>{l(addComment({postId:n,comment:e}))}})]})]})};function V(){return(0,r.jsx)(Q,{})}},6639:(n,e,t)=>{"use strict";t.d(e,{Ay:()=>c,_J:()=>d,gT:()=>a,iD:()=>s,oe:()=>o,ri:()=>u});var r=t(8943),i=t(2651);(0,r.zD)("auth/loginUser",async(n,e)=>{let{username:t,password:r}=n,{rejectWithValue:a}=e;try{let{token:n}=(await i.A.post("/api/auth/login",{username:t,password:r})).data;return console.log("Токен после логина:",n),localStorage.setItem("token",n),{...JSON.parse(atob(n.split(".")[1])),token:n}}catch(n){var o;return a((null===(o=n.response)||void 0===o?void 0:o.data)||n.message)}}),(0,r.zD)("auth/registerUser",async(n,e)=>{let{username:t,password:r,email:a}=n,{rejectWithValue:o}=e;try{let{token:n}=(await i.A.post("/api/auth/register",{username:t,password:r,email:a})).data;return localStorage.setItem("token",n),{...JSON.parse(atob(n.split(".")[1])),token:n}}catch(n){var d;return o((null===(d=n.response)||void 0===d?void 0:d.data)||n.message)}});let a=(0,r.zD)("auth/fetchFriends",async(n,e)=>{let{rejectWithValue:t}=e;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return(await i.A.get("/api/friends",{params:{userId:n},headers:{Authorization:"Bearer ".concat(e)}})).data}catch(n){var r;return t((null===(r=n.response)||void 0===r?void 0:r.data)||n.message)}}),o=(0,r.zD)("auth/addFriendToServer",async(n,e)=>{let{friendId:t}=n,{rejectWithValue:r}=e;try{let n=localStorage.getItem("token");if(!n)throw Error("Нет доступа: пользователь не авторизован");return(await i.A.post("/api/friends",{friendId:t},{headers:{Authorization:"Bearer ".concat(n)}})).data}catch(n){var a;return r((null===(a=n.response)||void 0===a?void 0:a.data)||n.message)}}),d=(0,r.zD)("auth/removeFriendFromServer",async(n,e)=>{let{userId:t,friendId:r}=n,{rejectWithValue:a}=e;try{let n=localStorage.getItem("token");if(!n)throw Error("Нет доступа: пользователь не авторизован");return await i.A.delete("/api/friends",{data:{userId:t,friendId:r},headers:{Authorization:"Bearer ".concat(n)}}),{userId:t,friendId:r}}catch(n){var o;return a((null===(o=n.response)||void 0===o?void 0:o.data)||n.message)}}),l=(0,r.Z0)({name:"auth",initialState:{currentUser:null,isAdmin:!1,isAuthenticated:!1,friends:[],status:"idle",error:null},reducers:{login:(n,e)=>{let{username:t,email:r,id:i,isAdmin:a,token:o}=e.payload;n.currentUser={username:t,email:r,id:i},n.isAdmin=a,n.isAuthenticated=!0,localStorage.setItem("token",o)},logout:n=>{localStorage.removeItem("token"),n.currentUser=null,n.isAdmin=!1,n.isAuthenticated=!1,n.friends=[]}},extraReducers:n=>{n.addCase(a.pending,n=>{n.status="loading"}).addCase(a.fulfilled,(n,e)=>{n.status="succeeded",n.friends=e.payload}).addCase(a.rejected,(n,e)=>{n.status="failed",n.error=e.payload}).addCase(o.pending,n=>{n.status="loading"}).addCase(o.fulfilled,(n,e)=>{n.status="succeeded",n.friends.push(e.payload)}).addCase(o.rejected,(n,e)=>{n.status="failed",n.error=e.payload}).addCase(d.pending,n=>{n.status="loading"}).addCase(d.fulfilled,(n,e)=>{n.status="succeeded",n.friends=n.friends.filter(n=>n.id!==e.payload.friendId)}).addCase(d.rejected,(n,e)=>{n.status="failed",n.error=e.payload})}}),{login:s,logout:u}=l.actions,c=l.reducer},2817:(n,e,t)=>{"use strict";t.d(e,{$:()=>d});var r=t(5155);t(2115);var i=t(698);function a(){let n=(0,i._)(["\n  border-radius: 10px;\n    color: white;\n    transition: .2s linear;\n    background: #0B63F6;\n    padding: 5px 15px;\n    cursor:pointer;\n\n    &:hover{\n  box-shadow: 0 0 0 2px white, 0 0 0 4px #3C82F8;\n    }\n"]);return a=function(){return n},n}let o=t(5285).Ay.button(a()),d=n=>{let{children:e,...t}=n;return(0,r.jsx)(o,{...t,children:e})}},5360:(n,e,t)=>{"use strict";t.d(e,{m:()=>d});var r=t(5155);t(2115);var i=t(698);function a(){let n=(0,i._)(["\n    max-width: 1024px;\n    margin: 0 auto;\n    gap: 20px;\n    margin-top: 50px;\n"]);return a=function(){return n},n}let o=t(5285).Ay.div(a()),d=n=>{let{children:e}=n;return(0,r.jsx)(o,{children:e})}},539:(n,e,t)=>{"use strict";t.d(e,{h:()=>d});var r=t(5155);t(2115);var i=t(698);function a(){let n=(0,i._)(["\nfont-size: 26px;\n    line-height: 26px;\n    align-items: center;\n    display: flex;\n    flex-direction: column;\n    font-: 26px;\n    font-weight: 400;\n"]);return a=function(){return n},n}let o=t(5285).Ay.h1(a()),d=n=>{let{children:e}=n;return(0,r.jsx)(o,{children:e})}}},n=>{var e=e=>n(n.s=e);n.O(0,[694,651,441,517,358],()=>e(3139)),_N_E=n.O()}]);