(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{9949:(e,t,r)=>{Promise.resolve().then(r.bind(r,7451))},267:(e,t,r)=>{"use strict";r.d(t,{G:()=>l,_:()=>o});var n=r(698),a=r(5285);function s(){let e=(0,n._)(["\n     max-width: 400px;\n    margin: 0 auto;\n    padding: 20px;\n    background-color: #b39393;\n    border-radius: 10px;\n    box-shadow: 0 4px 10px rgb(39 5 5 / 10%);\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n"]);return s=function(){return e},e}function i(){let e=(0,n._)(["\ndisplay: flex;\n    flex-direction: column;\n    max-width: 280px;\n    width: 100%;\n  \n    gap: 15px;\n    padding: 33px 58px;\n"]);return i=function(){return e},e}let o=a.Ay.div(s()),l=a.Ay.form(i())},7451:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var n=r(5155),a=r(2115),s=r(3391),i=r(6639),o=r(6046),l=r(1591),d=r(2817),u=r(5360),c=r(539),p=r(267),h=r(4877);let f=()=>({get:(0,a.useCallback)(e=>{try{let t=localStorage.getItem(e);return console.log('Получение данных из localStorage для ключа "'.concat(e,'":'),t),t?JSON.parse(t):null}catch(t){return console.error('Ошибка при чтении ключа "'.concat(e,'" из localStorage:'),t),null}},[]),set:(0,a.useCallback)((e,t)=>{try{console.log('Сохранение данных в localStorage для ключа "'.concat(e,'":'),t);let r=JSON.stringify(t);localStorage.setItem(e,r)}catch(t){console.error('Ошибка при записи ключа "'.concat(e,'" в localStorage:'),t)}},[])});var g=r(9606);let m=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,x=/^(?=.*[a-zA-Z])(?=.*[!@#$%^&*])/,v=()=>{var e,t,r;let v=(0,s.wA)(),y=(0,o.useRouter)(),{get:A,set:w}=f(),[j,b]=(0,a.useState)(null),{register:S,handleSubmit:_,formState:{errors:k}}=(0,g.mN)();return(0,a.useEffect)(()=>{if(j){let e=A("users")||[];e.push(j),w("users",e),v((0,i.iD)({id:j.id,username:j.username,email:j.email,isAdmin:j.isAdmin})),y.push("/")}},[j,v,y,A,w]),(0,n.jsx)(u.m,{children:(0,n.jsxs)(p._,{children:[(0,n.jsx)(c.h,{children:"Регистрация"}),(0,n.jsxs)(p.G,{onSubmit:_(e=>{let{username:t,password:r,email:n,isAdmin:a}=e;b({id:Date.now(),username:t,password:r,email:n,isAdmin:a})}),children:[(0,n.jsx)(h.J,{children:(0,n.jsx)(l.p,{name:"username",type:"text",placeholder:"Имя пользователя",errorMessage:null===(e=k.username)||void 0===e?void 0:e.message,...S("username",{required:"Имя пользователя обязательно",minLength:{value:3,message:"Имя пользователя должно быть не меньше 3 символов"}})})}),(0,n.jsx)(h.J,{children:(0,n.jsx)(l.p,{name:"email",type:"email",placeholder:"Введите ваш адрес электронной почты",errorMessage:null===(t=k.email)||void 0===t?void 0:t.message,...S("email",{required:"Почта обязательна",pattern:{value:m,message:"Введите корректный адрес электронной почты"}})})}),(0,n.jsx)(h.J,{children:(0,n.jsx)(l.p,{name:"password",type:"password",placeholder:"Пароль",errorMessage:null===(r=k.password)||void 0===r?void 0:r.message,...S("password",{required:"Пароль обязателен",pattern:{value:x,message:"Пароль должен содержать хотя бы одну заглавную букву и один спецсимвол"}})})}),(0,n.jsxs)(h.J,{children:[(0,n.jsx)(l.p,{type:"checkbox",...S("isAdmin")}),"Сделать меня администратором"]}),(0,n.jsx)(d.$,{type:"submit",children:"Зарегистрироваться"})]})]})})};function y(){return(0,n.jsx)(v,{})}},6639:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>c,_J:()=>o,gT:()=>s,iD:()=>d,oe:()=>i,ri:()=>u});var n=r(8943),a=r(2651);(0,n.zD)("auth/loginUser",async(e,t)=>{let{username:r,password:n}=e,{rejectWithValue:s}=t;try{let{token:e}=(await a.A.post("/api/auth/login",{username:r,password:n})).data;return console.log("Токен после логина:",e),localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var i;return s((null===(i=e.response)||void 0===i?void 0:i.data)||e.message)}}),(0,n.zD)("auth/registerUser",async(e,t)=>{let{username:r,password:n,email:s}=e,{rejectWithValue:i}=t;try{let{token:e}=(await a.A.post("/api/auth/register",{username:r,password:n,email:s})).data;return localStorage.setItem("token",e),{...JSON.parse(atob(e.split(".")[1])),token:e}}catch(e){var o;return i((null===(o=e.response)||void 0===o?void 0:o.data)||e.message)}});let s=(0,n.zD)("auth/fetchFriends",async(e,t)=>{let{rejectWithValue:r}=t;try{let t=localStorage.getItem("token");if(!t)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.get("/api/friends",{params:{userId:e},headers:{Authorization:"Bearer ".concat(t)}})).data}catch(e){var n;return r((null===(n=e.response)||void 0===n?void 0:n.data)||e.message)}}),i=(0,n.zD)("auth/addFriendToServer",async(e,t)=>{let{friendId:r}=e,{rejectWithValue:n}=t;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return(await a.A.post("/api/friends",{friendId:r},{headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var s;return n((null===(s=e.response)||void 0===s?void 0:s.data)||e.message)}}),o=(0,n.zD)("auth/removeFriendFromServer",async(e,t)=>{let{userId:r,friendId:n}=e,{rejectWithValue:s}=t;try{let e=localStorage.getItem("token");if(!e)throw Error("Нет доступа: пользователь не авторизован");return await a.A.delete("/api/friends",{data:{userId:r,friendId:n},headers:{Authorization:"Bearer ".concat(e)}}),{userId:r,friendId:n}}catch(e){var i;return s((null===(i=e.response)||void 0===i?void 0:i.data)||e.message)}}),l=(0,n.Z0)({name:"auth",initialState:{currentUser:null,isAdmin:!1,isAuthenticated:!1,friends:[],status:"idle",error:null},reducers:{login:(e,t)=>{let{username:r,email:n,id:a,isAdmin:s,token:i}=t.payload;e.currentUser={username:r,email:n,id:a},e.isAdmin=s,e.isAuthenticated=!0,localStorage.setItem("token",i)},logout:e=>{localStorage.removeItem("token"),e.currentUser=null,e.isAdmin=!1,e.isAuthenticated=!1,e.friends=[]}},extraReducers:e=>{e.addCase(s.pending,e=>{e.status="loading"}).addCase(s.fulfilled,(e,t)=>{e.status="succeeded",e.friends=t.payload}).addCase(s.rejected,(e,t)=>{e.status="failed",e.error=t.payload}).addCase(i.pending,e=>{e.status="loading"}).addCase(i.fulfilled,(e,t)=>{e.status="succeeded",e.friends.push(t.payload)}).addCase(i.rejected,(e,t)=>{e.status="failed",e.error=t.payload}).addCase(o.pending,e=>{e.status="loading"}).addCase(o.fulfilled,(e,t)=>{e.status="succeeded",e.friends=e.friends.filter(e=>e.id!==t.payload.friendId)}).addCase(o.rejected,(e,t)=>{e.status="failed",e.error=t.payload})}}),{login:d,logout:u}=l.actions,c=l.reducer},2817:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});var n=r(5155);r(2115);var a=r(698);function s(){let e=(0,a._)(["\n  border-radius: 10px;\n    color: white;\n    transition: .2s linear;\n    background: #0B63F6;\n    padding: 5px 15px;\n    cursor:pointer;\n\n    &:hover{\n  box-shadow: 0 0 0 2px white, 0 0 0 4px #3C82F8;\n    }\n"]);return s=function(){return e},e}let i=r(5285).Ay.button(s()),o=e=>{let{children:t,...r}=e;return(0,n.jsx)(i,{...r,children:t})}},5360:(e,t,r)=>{"use strict";r.d(t,{m:()=>o});var n=r(5155);r(2115);var a=r(698);function s(){let e=(0,a._)(["\n    max-width: 1024px;\n    margin: 0 auto;\n    gap: 20px;\n    margin-top: 50px;\n"]);return s=function(){return e},e}let i=r(5285).Ay.div(s()),o=e=>{let{children:t}=e;return(0,n.jsx)(i,{children:t})}},1591:(e,t,r)=>{"use strict";r.d(t,{p:()=>h});var n=r(5155),a=r(2115),s=r(698),i=r(5285);function o(){let e=(0,s._)(["\n   width: 100%;\n   \n"]);return o=function(){return e},e}function l(){let e=(0,s._)(["\n    outline: none;\n    border: 1px solid ","; \n    padding: 11px 3px;\n    border-radius: 5px;\n    width: 100%;\n    max-width: 100%;\n  \n\n    &:focus {\n        border-color: ",";\n    }\n"]);return l=function(){return e},e}function d(){let e=(0,s._)(["\n    color: red;\n    font-size: 0.75rem;\n    top: 50%;\n    left: 10px;\n    transform: translateY(-50%);\n    pointer-events: none;\n"]);return d=function(){return e},e}let u=i.Ay.div(o()),c=i.Ay.input(l(),e=>{let{$error:t}=e;return"true"===t?"red":"#282c34"},e=>{let{$error:t}=e;return"true"===t?"red":"#007BFF"}),p=i.Ay.span(d()),h=a.forwardRef((e,t)=>{let{errorMessage:r,...a}=e;return(0,n.jsxs)(u,{children:[(0,n.jsx)(c,{ref:t,...a,$error:r?"true":void 0}),r&&(0,n.jsx)(p,{children:r})]})})},4877:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var n=r(5155);r(2115);var a=r(698);function s(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  align-items:center;\n  gap: 10px;\n"]);return s=function(){return e},e}let i=r(5285).Ay.label(s()),o=e=>{let{children:t}=e;return(0,n.jsx)(i,{children:t})}},539:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});var n=r(5155);r(2115);var a=r(698);function s(){let e=(0,a._)(["\nfont-size: 26px;\n    line-height: 26px;\n    align-items: center;\n    display: flex;\n    flex-direction: column;\n    font-: 26px;\n    font-weight: 400;\n"]);return s=function(){return e},e}let i=r(5285).Ay.h1(s()),o=e=>{let{children:t}=e;return(0,n.jsx)(i,{children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[694,651,533,441,517,358],()=>t(9949)),_N_E=e.O()}]);