(()=>{var e={};e.id=318,e.ids=[318],e.modules={6037:e=>{"use strict";e.exports=require("mongoose")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},4326:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>h,serverHooks:()=>S,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{GET:()=>g,OPTIONS:()=>w,POST:()=>y});var n=t(2706),o=t(8203),i=t(5994),a=t(6037),u=t.n(a);let p=new(u()).Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},email:{type:String,required:!0,unique:!0},isAdmin:{type:Boolean,default:!1}}),c=u().models.User||u().model("User",p);var l=t(5716),d=t(8387);async function y(e){try{await (0,d.A)();let{username:r,password:t,email:s}=await e.json();if(!r||!t||!s)return new Response(JSON.stringify({error:"Все поля обязательны"}),{status:400,headers:{"Content-Type":"application/json"}});if(await c.findOne({$or:[{username:r},{email:s}]}))return new Response(JSON.stringify({error:"Пользователь с таким username или email уже существует"}),{status:409,headers:{"Content-Type":"application/json"}});let n=new c({username:r,password:t,email:s});await n.save();let o=(0,l.H)({id:n._id,username:n.username}),i=new Headers;return i.append("Set-Cookie",`authorization=Bearer ${o}; HttpOnly; Path=/; Max-Age=3600;`),i.append("Content-Type","application/json"),new Response(JSON.stringify(n),{status:201,headers:i})}catch(e){return new Response(JSON.stringify({error:"Ошибка при регистрации",details:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}async function g(e){try{await (0,d.A)();let{searchParams:r}=new URL(e.url),t=r.get("currentUser");if(!t)return new Response(JSON.stringify({error:"currentUser не указан"}),{status:400,headers:{"Content-Type":"application/json"}});let s=await c.find({username:{$ne:t}});return new Response(JSON.stringify(s),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({error:"Ошибка при загрузке пользователей",details:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}function w(){return new Response(null,{status:204,headers:{Allow:"GET, POST, OPTIONS","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let h=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"D:\\SocialNext\\my-app\\src\\app\\api\\users\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:S}=h;function x(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},6487:()=>{},8335:()=>{},5716:(e,r,t)=>{"use strict";t.d(r,{H:()=>i,n:()=>a});var s=t(3008),n=t.n(s);let o=process.env.SECRET_KEY||"your_secret_key",i=e=>n().sign(e,o,{expiresIn:"1h"}),a=e=>{try{return n().verify(e,o)}catch(e){throw console.error("Ошибка проверки токена:",e),Error("Неверный или истекший токен")}}},8387:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var s=t(6037),n=t.n(s);let o=!1,i=async()=>{if(o){console.log("Используется существующее подключение к MongoDB");return}try{o=!!(await n().connect("mongodb+srv://kirillshved96:hsX2bhLX1uR9M8yf@socialnext.5uzui.mongodb.net/?retryWrites=true&w=majority&appName=SocialNext")).connections[0].readyState,console.log("Подключено к MongoDB")}catch(e){throw console.error("Ошибка подключения к MongoDB:",e),"ENODATA"===e.code&&console.error('Ошибка DNS. Проверьте строку подключения (MONGO_URI) и убедитесь, что ваш кластер MongoDB доступен. Если используется MongoDB Atlas, убедитесь, что вы указали правильный "cluster-url".'),e}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[994,604],()=>t(4326));module.exports=s})();